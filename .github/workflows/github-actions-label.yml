name: GitHub Actions Demo
on:
  pull_request:
    types: [labeled]
jobs:
  build:
    if: ${{ github.event.label.name == 'bug' }}
    runs-on: ubuntu-latest
    steps:
      - name: Print Event Info
        env:
          WEBHOOK_SECRET: ${{ secrets.WEBHOOK_SECRET }}
          WEBHOOK_KEY: ${{ secrets.WEBHOOK_KEY }}
        run: |
          echo "secret $WEBHOOK_SECRET key $WEBHOOK_KEY"
      - run: |
          echo "ðŸ”Ž The name of the branch is ${{ github.head_ref }}."
      - name: Trigger Webhook
        env:
          WEBHOOK_SECRET: ${{ secrets.WEBHOOK_SECRET }}
          WEBHOOK_KEY: ${{ secrets.WEBHOOK_KEY }}
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            "https://cloudbuild.googleapis.com/v1/projects/striped-temple-418614/locations/global/triggers/test-webhook-label:webhook?key=${WEBHOOK_KEY}&secret=${WEBHOOK_SECRET}&trigger=test-webhook-label&projectId=striped-temple-418614" \
            -d '{"_BRANCH_NAME": "${{ github.head_ref }}", "_LAST_LABEL": "${{ github.event.label.name }}"}'
